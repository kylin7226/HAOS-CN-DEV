# ROCK 5B specific kernel configuration with RKNPU support
# Based on mainline kernel 6.12.33 + out-of-tree RKNPU driver

#
# Enhanced GPU and NPU Support for RK3588
#

# Mali GPU Driver (Panfrost - mainline driver)
CONFIG_DRM=y
CONFIG_DRM_PANFROST=y
# Note: CONFIG_DRM_LIMA is for older Mali GPUs
# CONFIG_DRM_LIMA is not set

# RKNPU Support (out-of-tree driver)
# Note: This will be provided by the rknpu-driver package
# The following configs enable kernel features needed by RKNPU driver

# DMA buffer framework for NPU memory management
CONFIG_DMA_SHARED_BUFFER=y
CONFIG_DMA_HEAP=y
CONFIG_DMA_HEAP_SYSTEM=y
CONFIG_DMA_HEAP_CMA=y

# Character device support for NPU
CONFIG_MISC_FILESYSTEMS=y

# ION memory allocator (if needed by RKNPU driver)
# CONFIG_ION is not set (deprecated in mainline)

# Video Processing Units (Enhanced for NPU)
CONFIG_V4L2_MEM2MEM_DEV=y
CONFIG_VIDEOBUF2_CORE=y
CONFIG_VIDEOBUF2_DMA_CONTIG=y
CONFIG_VIDEOBUF2_MEMOPS=y
CONFIG_VIDEOBUF2_DMA_SG=y

# RGA support may be limited in mainline
# CONFIG_ROCKCHIP_RGA may not be available
# CONFIG_ROCKCHIP_RGA2 may not be available

# VPU support (may be limited)
# CONFIG_ROCKCHIP_VDEC may not be available  
# CONFIG_ROCKCHIP_VENC may not be available

# IOMMU Support (Enhanced for NPU)
CONFIG_IOMMU_SUPPORT=y
CONFIG_ROCKCHIP_IOMMU=y
CONFIG_IOMMU_DMA=y
CONFIG_IOMMU_DEFAULT_DMA_STRICT=y

# DMA Engine support (Enhanced)
CONFIG_DMADEVICES=y
CONFIG_PL330_DMA=y
CONFIG_ASYNC_TX_DMA=y

# CMA (Contiguous Memory Allocator) - Enhanced for NPU
CONFIG_CMA=y
CONFIG_DMA_CMA=y
CONFIG_CMA_SIZE_MBYTES=512
CONFIG_CMA_SIZE_SEL_MBYTES=y
CONFIG_CMA_ALIGNMENT=8

# Performance monitoring for NPU
CONFIG_ARM_PMU=y
CONFIG_HW_PERF_EVENTS=y
CONFIG_PERF_EVENTS=y

# Enhanced debugging for NPU development
CONFIG_DEBUG_FS=y
CONFIG_DEBUG_KERNEL=y

# Additional RK3588 support that may be available
CONFIG_ROCKCHIP_THERMAL=y
CONFIG_ROCKCHIP_LVDS=y
CONFIG_PWM_ROCKCHIP=y
CONFIG_ROCKCHIP_SARADC=y
CONFIG_SPI_ROCKCHIP=y
CONFIG_I2C_RK3X=y

# PCIe support for RK3588
CONFIG_PCIE_ROCKCHIP_DW_HOST=y
CONFIG_PCI=y
CONFIG_PCIEPORTBUS=y

# USB support
CONFIG_USB_DWC3=y
CONFIG_USB_DWC3_OF_SIMPLE=y
CONFIG_USB_EHCI_HCD=y
CONFIG_USB_OHCI_HCD=y

# Ethernet (2.5G support)
CONFIG_STMMAC_ETH=y
CONFIG_DWMAC_ROCKCHIP=y

# SATA support
CONFIG_SATA_AHCI=y
CONFIG_AHCI_PLATFORM=y
CONFIG_SATA_AHCI_PLATFORM=y

# Device Tree support
CONFIG_OF=y
CONFIG_OF_EARLY_FLATTREE=y
CONFIG_OF_FLATTREE=y

# Power management for NPU
CONFIG_PM=y
CONFIG_PM_SLEEP=y
CONFIG_PM_RUNTIME=y
CONFIG_PM_CLK=y

# Rockchip power domains
CONFIG_ROCKCHIP_PM_DOMAINS=y

# Clock support for RK3588
CONFIG_COMMON_CLK=y
CONFIG_CLK_ROCKCHIP=y